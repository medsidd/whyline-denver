{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v6.json", "dbt_version": "1.8.5", "generated_at": "2025-10-28T08:35:56.416949Z", "invocation_id": "419956b5-e96b-4457-a7f0-80eef43c564f", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2025-10-28T08:35:02.021593Z", "completed_at": "2025-10-28T08:35:02.034125Z"}, {"name": "execute", "started_at": "2025-10-28T08:35:02.034680Z", "completed_at": "2025-10-28T08:35:02.881901Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.8614110946655273, "adapter_response": {"_message": "CREATE VIEW (0 processed)", "code": "CREATE VIEW", "bytes_processed": 0, "bytes_billed": 0, "location": "US", "project_id": "whyline-denver", "job_id": "6502c75a-f234-422d-ac3e-05ac27514247", "slot_ms": 0}, "message": "CREATE VIEW (0 processed)", "failures": null, "unique_id": "model.whylinedenver_dbt.stg_gtfs_stop_times", "compiled": true, "compiled_code": "\n\nwith base as (\n    select\n        trip_id,\n        stop_id,\n        stop_sequence,\n        arrival_time,\n        departure_time\n    from `whyline-denver`.`raw_denver`.`raw_gtfs_stop_times`\n),\nnorm as (\n    select\n        *,\n        split(arrival_time, ':')[offset(0)] as a_h,\n        split(arrival_time, ':')[offset(1)] as a_m,\n        split(arrival_time, ':')[offset(2)] as a_s,\n        split(departure_time, ':')[offset(0)] as d_h,\n        split(departure_time, ':')[offset(1)] as d_m,\n        split(departure_time, ':')[offset(2)] as d_s\n    from base\n)\nselect\n    trip_id,\n    stop_id,\n    stop_sequence,\n    arrival_time,\n    departure_time,\n    cast(a_h as int64) as arr_hour_gtfs,\n    cast(d_h as int64) as dep_hour_gtfs,\n    case\n        when cast(a_h as int64) is null then null\n        else cast(a_h as int64)\n    end as arr_hour_bucket\nfrom norm", "relation_name": "`whyline-denver`.`stg_denver`.`stg_gtfs_stop_times`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-10-28T08:35:02.887055Z", "completed_at": "2025-10-28T08:35:02.893079Z"}, {"name": "execute", "started_at": "2025-10-28T08:35:02.893703Z", "completed_at": "2025-10-28T08:35:03.649941Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.7638740539550781, "adapter_response": {"_message": "CREATE VIEW (0 processed)", "code": "CREATE VIEW", "bytes_processed": 0, "bytes_billed": 0, "location": "US", "project_id": "whyline-denver", "job_id": "c48751b9-80d2-4e2b-98f7-eaeb05ccb83a", "slot_ms": 0}, "message": "CREATE VIEW (0 processed)", "failures": null, "unique_id": "model.whylinedenver_dbt.stg_gtfs_trips", "compiled": true, "compiled_code": "\n\nwith cal as (\n    select\n        service_id,\n        start_date,\n        end_date,\n        monday,\n        tuesday,\n        wednesday,\n        thursday,\n        friday,\n        saturday,\n        sunday\n    from `whyline-denver`.`raw_denver`.`raw_gtfs_calendar`\n),\nex as (\n    select\n        service_id,\n        array_agg(case when exception_type = 1 then date end ignore nulls) as added_service_dates,\n        array_agg(case when exception_type = 2 then date end ignore nulls) as removed_service_dates\n    from `whyline-denver`.`raw_denver`.`raw_gtfs_calendar_dates`\n    group by service_id\n),\ntr as (\n    select\n        trip_id,\n        route_id,\n        service_id,\n        direction_id,\n        shape_id,\n        trip_headsign\n    from `whyline-denver`.`raw_denver`.`raw_gtfs_trips`\n)\nselect\n    tr.trip_id,\n    tr.route_id,\n    tr.service_id,\n    tr.direction_id,\n    tr.shape_id,\n    tr.trip_headsign,\n    cal.start_date,\n    cal.end_date,\n    cal.monday,\n    cal.tuesday,\n    cal.wednesday,\n    cal.thursday,\n    cal.friday,\n    cal.saturday,\n    cal.sunday,\n    ex.added_service_dates,\n    ex.removed_service_dates\nfrom tr\nleft join cal using (service_id)\nleft join ex using (service_id)", "relation_name": "`whyline-denver`.`stg_denver`.`stg_gtfs_trips`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-10-28T08:35:03.655189Z", "completed_at": "2025-10-28T08:35:03.660362Z"}, {"name": "execute", "started_at": "2025-10-28T08:35:03.660875Z", "completed_at": "2025-10-28T08:35:04.458076Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.8038191795349121, "adapter_response": {"_message": "CREATE VIEW (0 processed)", "code": "CREATE VIEW", "bytes_processed": 0, "bytes_billed": 0, "location": "US", "project_id": "whyline-denver", "job_id": "43753952-0149-42f7-b894-22d12c1911a8", "slot_ms": 0}, "message": "CREATE VIEW (0 processed)", "failures": null, "unique_id": "model.whylinedenver_dbt.stg_weather", "compiled": true, "compiled_code": "\n\nwith base as (\n    select\n        date,\n        station,\n        snow_mm,\n        precip_mm,\n        tmin_c,\n        tmax_c,\n        tavg_c,\n        snow_day,\n        precip_bin,\n        _ingested_at\n    from `whyline-denver`.`raw_denver`.`raw_weather_daily`\n),\ndeduped as (\n    select\n        *,\n        row_number() over (\n            partition by date, station\n            order by _ingested_at desc\n        ) as record_rank\n    from base\n)\n\nselect\n    date,\n    station,\n    snow_mm,\n    precip_mm,\n    tmin_c,\n    tmax_c,\n    tavg_c,\n    snow_day,\n    precip_bin\nfrom deduped\nwhere record_rank = 1", "relation_name": "`whyline-denver`.`stg_denver`.`stg_weather`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-10-28T08:35:04.460451Z", "completed_at": "2025-10-28T08:35:04.464301Z"}, {"name": "execute", "started_at": "2025-10-28T08:35:04.464619Z", "completed_at": "2025-10-28T08:35:05.409776Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.9502489566802979, "adapter_response": {"_message": "CREATE VIEW (0 processed)", "code": "CREATE VIEW", "bytes_processed": 0, "bytes_billed": 0, "location": "US", "project_id": "whyline-denver", "job_id": "f768a7e6-cac0-4d5f-bb05-9e1ed709e9a6", "slot_ms": 0}, "message": "CREATE VIEW (0 processed)", "failures": null, "unique_id": "model.whylinedenver_dbt.int_scheduled_arrivals", "compiled": true, "compiled_code": "\n\nwith st as (\n    select\n        trip_id,\n        stop_id,\n        stop_sequence,\n        nullif(arrival_time, '') as arrival_time,\n        nullif(departure_time, '') as departure_time\n    from `whyline-denver`.`stg_denver`.`stg_gtfs_stop_times`\n),\ntr as (\n    select\n        trip_id,\n        route_id,\n        direction_id,\n        case\n            when start_date is null or start_date = '' then null\n            else parse_date('%Y%m%d', start_date)\n        end as service_start_date\n    from `whyline-denver`.`stg_denver`.`stg_gtfs_trips`\n),\njoined as (\n    select\n        st.trip_id,\n        st.stop_id,\n        st.stop_sequence,\n        tr.route_id,\n        tr.direction_id,\n        case\n            when st.arrival_time is not null and tr.service_start_date is not null then\n                \ntimestamp(\n    datetime(\n        date_add(\n            tr.service_start_date,\n            interval cast(floor(\n                safe_cast(split(st.arrival_time, ':')[offset(0)] as int64) / 24\n            ) as int64) day\n        ),\n        time(\n            mod(\n                safe_cast(split(st.arrival_time, ':')[offset(0)] as int64),\n                24\n            ),\n            safe_cast(split(st.arrival_time, ':')[offset(1)] as int64),\n            safe_cast(split(st.arrival_time, ':')[offset(2)] as int64)\n        )\n    ),\n    \"America/Denver\"\n)\n\n        end as sched_arrival_ts_mst,\n        case\n            when st.departure_time is not null and tr.service_start_date is not null then\n                \ntimestamp(\n    datetime(\n        date_add(\n            tr.service_start_date,\n            interval cast(floor(\n                safe_cast(split(st.departure_time, ':')[offset(0)] as int64) / 24\n            ) as int64) day\n        ),\n        time(\n            mod(\n                safe_cast(split(st.departure_time, ':')[offset(0)] as int64),\n                24\n            ),\n            safe_cast(split(st.departure_time, ':')[offset(1)] as int64),\n            safe_cast(split(st.departure_time, ':')[offset(2)] as int64)\n        )\n    ),\n    \"America/Denver\"\n)\n\n        end as sched_departure_ts_mst\n    from st\n    join tr\n        on st.trip_id = tr.trip_id\n)\n\nselect\n    trip_id,\n    stop_id,\n    stop_sequence,\n    route_id,\n    direction_id,\n    sched_arrival_ts_mst,\n    sched_departure_ts_mst,\n    \n    DATE(coalesce(sched_arrival_ts_mst, sched_departure_ts_mst), \"America/Denver\")\n as service_date_mst\nfrom joined", "relation_name": "`whyline-denver`.`stg_denver`.`int_scheduled_arrivals`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-10-28T08:35:05.415631Z", "completed_at": "2025-10-28T08:35:05.424999Z"}, {"name": "execute", "started_at": "2025-10-28T08:35:05.425419Z", "completed_at": "2025-10-28T08:35:06.324193Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.9097309112548828, "adapter_response": {"_message": "CREATE VIEW (0 processed)", "code": "CREATE VIEW", "bytes_processed": 0, "bytes_billed": 0, "location": "US", "project_id": "whyline-denver", "job_id": "9a53a68c-5812-4de2-9bba-ff8e019b47e1", "slot_ms": 0}, "message": "CREATE VIEW (0 processed)", "failures": null, "unique_id": "model.whylinedenver_dbt.stg_rt_events", "compiled": true, "compiled_code": "\n\nwith trips as (\n    select\n        trip_id,\n        direction_id,\n        trip_headsign\n    from `whyline-denver`.`stg_denver`.`stg_gtfs_trips`\n),\ntu as (\n    select\n        feed_ts_utc,\n        entity_id as tu_entity_id,\n        trip_id,\n        route_id,\n        stop_id,\n        stop_sequence,\n        arrival_delay_sec,\n        departure_delay_sec,\n        schedule_relationship,\n        event_ts_utc as tu_event_ts_utc\n    from `whyline-denver`.`raw_denver`.`raw_gtfsrt_trip_updates`\n),\nvp as (\n    select\n        feed_ts_utc,\n        entity_id as vp_entity_id,\n        trip_id,\n        route_id,\n        vehicle_id,\n        vehicle_label,\n        lon,\n        lat,\n        bearing,\n        speed_mps,\n        event_ts_utc as vp_event_ts_utc\n    from `whyline-denver`.`raw_denver`.`raw_gtfsrt_vehicle_positions`\n),\nj as (\n    select\n        coalesce(tu.feed_ts_utc, vp.feed_ts_utc) as feed_ts_utc,\n        coalesce(tu.trip_id, vp.trip_id) as trip_id,\n        coalesce(tu.route_id, vp.route_id) as route_id,\n        tu.tu_entity_id,\n        vp.vp_entity_id,\n        tu.stop_id,\n        tu.stop_sequence,\n        tu.arrival_delay_sec,\n        tu.departure_delay_sec,\n        tu.schedule_relationship,\n        vp.vehicle_id,\n        vp.vehicle_label,\n        vp.lon,\n        vp.lat,\n        vp.bearing,\n        vp.speed_mps,\n        \n    ST_GEOGPOINT(CAST(vp.lon AS FLOAT64), CAST(vp.lat AS FLOAT64))\n as geom,\n        coalesce(tu.tu_event_ts_utc, vp.vp_event_ts_utc, coalesce(tu.feed_ts_utc, vp.feed_ts_utc)) as event_ts_utc\n    from tu\n    full outer join vp\n        on tu.feed_ts_utc = vp.feed_ts_utc\n        and tu.trip_id = vp.trip_id\n        and tu.route_id = vp.route_id\n),\nranked as (\n    select\n        *,\n        row_number() over (\n            partition by feed_ts_utc, trip_id\n            order by event_ts_utc desc, tu_entity_id desc, vp_entity_id desc\n        ) as trip_rank\n    from j\n)\nselect\n    r.feed_ts_utc,\n    r.trip_id,\n    r.route_id,\n    r.tu_entity_id,\n    r.vp_entity_id,\n    r.stop_id,\n    r.stop_sequence,\n    r.arrival_delay_sec,\n    r.departure_delay_sec,\n    r.schedule_relationship,\n    r.vehicle_id,\n    r.vehicle_label,\n    r.lon,\n    r.lat,\n    r.bearing,\n    r.speed_mps,\n    r.geom,\n    r.event_ts_utc,\n    t.direction_id,\n    t.trip_headsign,\n    \n    DATE(r.event_ts_utc, \"America/Denver\")\n as event_date_mst,\n    \n    EXTRACT(HOUR FROM DATETIME(r.event_ts_utc, \"America/Denver\"))\n as event_hour_mst\nfrom ranked as r\nleft join trips as t\n    on r.trip_id = t.trip_id\nwhere r.trip_rank = 1", "relation_name": "`whyline-denver`.`stg_denver`.`stg_rt_events`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-10-28T08:35:06.330039Z", "completed_at": "2025-10-28T08:35:06.337375Z"}, {"name": "execute", "started_at": "2025-10-28T08:35:06.338125Z", "completed_at": "2025-10-28T08:35:07.278676Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.9498467445373535, "adapter_response": {"_message": "CREATE VIEW (0 processed)", "code": "CREATE VIEW", "bytes_processed": 0, "bytes_billed": 0, "location": "US", "project_id": "whyline-denver", "job_id": "ec193ae6-ea97-4bf9-a775-97eea70b01e7", "slot_ms": 0}, "message": "CREATE VIEW (0 processed)", "failures": null, "unique_id": "model.whylinedenver_dbt.int_weather_by_date", "compiled": true, "compiled_code": "\n\nwith base as (\n    select\n        date,\n        station,\n        snow_day,\n        precip_bin,\n        precip_mm\n    from `whyline-denver`.`stg_denver`.`stg_weather`\n    \n        where station = 'USW00023062'\n    \n),\naggregated as (\n    select\n        date as service_date_mst,\n        max(coalesce(snow_day, 0)) as snow_day_flag,\n        array_agg(\n            precip_bin\n            ignore nulls\n            order by precip_mm desc\n        )[offset(0)] as precip_bin\n    from base\n    group by service_date_mst\n)\n\nselect\n    service_date_mst,\n    snow_day_flag > 0 as snow_day,\n    precip_bin\nfrom aggregated", "relation_name": "`whyline-denver`.`stg_denver`.`int_weather_by_date`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-10-28T08:35:07.282401Z", "completed_at": "2025-10-28T08:35:07.285844Z"}, {"name": "execute", "started_at": "2025-10-28T08:35:07.286374Z", "completed_at": "2025-10-28T08:35:08.233204Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.951807975769043, "adapter_response": {"_message": "CREATE VIEW (0 processed)", "code": "CREATE VIEW", "bytes_processed": 0, "bytes_billed": 0, "location": "US", "project_id": "whyline-denver", "job_id": "a2d16a02-bcb5-4d87-b881-2202efd4961f", "slot_ms": 0}, "message": "CREATE VIEW (0 processed)", "failures": null, "unique_id": "model.whylinedenver_dbt.int_stop_headways_scheduled", "compiled": true, "compiled_code": "\n\nwith base as (\n    select\n        route_id,\n        direction_id,\n        stop_id,\n        service_date_mst,\n        sched_arrival_ts_mst\n    from `whyline-denver`.`stg_denver`.`int_scheduled_arrivals`\n    where sched_arrival_ts_mst is not null\n),\ndeduped as (\n    select\n        route_id,\n        direction_id,\n        stop_id,\n        service_date_mst,\n        sched_arrival_ts_mst,\n        row_number() over (\n            partition by route_id, direction_id, stop_id, service_date_mst, sched_arrival_ts_mst\n            order by sched_arrival_ts_mst\n        ) as arrival_rank\n    from base\n)\n\nselect\n    route_id,\n    direction_id,\n    stop_id,\n    service_date_mst,\n    sched_arrival_ts_mst,\n    timestamp_diff(\n        sched_arrival_ts_mst,\n        lag(sched_arrival_ts_mst) over (\n            partition by route_id, direction_id, stop_id, service_date_mst\n            order by sched_arrival_ts_mst\n        ),\n        second\n    ) as sch_headway_sec\nfrom deduped\nwhere arrival_rank = 1", "relation_name": "`whyline-denver`.`stg_denver`.`int_stop_headways_scheduled`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-10-28T08:35:08.235678Z", "completed_at": "2025-10-28T08:35:08.238244Z"}, {"name": "execute", "started_at": "2025-10-28T08:35:08.238524Z", "completed_at": "2025-10-28T08:35:09.161864Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.9268937110900879, "adapter_response": {"_message": "CREATE VIEW (0 processed)", "code": "CREATE VIEW", "bytes_processed": 0, "bytes_billed": 0, "location": "US", "project_id": "whyline-denver", "job_id": "df825f12-332b-423e-8b43-8973589f1412", "slot_ms": 0}, "message": "CREATE VIEW (0 processed)", "failures": null, "unique_id": "model.whylinedenver_dbt.int_rt_events_resolved", "compiled": true, "compiled_code": "\n\nwith base as (\n    select\n        route_id,\n        trip_id,\n        stop_id,\n        direction_id,\n        event_date_mst as service_date_mst,\n        event_hour_mst,\n        event_ts_utc,\n        arrival_delay_sec,\n        departure_delay_sec,\n        coalesce(arrival_delay_sec, departure_delay_sec) as delay_sec_raw,\n        coalesce(arrival_delay_sec, departure_delay_sec, 0) as delay_sec\n    from `whyline-denver`.`stg_denver`.`stg_rt_events`\n)\n\nselect\n    route_id,\n    trip_id,\n    stop_id,\n    direction_id,\n    service_date_mst,\n    event_hour_mst,\n    event_ts_utc,\n    delay_sec,\n    delay_sec_raw,\n    case\n        when abs(delay_sec) <= 300 then 1\n        else 0\n    end as is_on_time\nfrom base", "relation_name": "`whyline-denver`.`stg_denver`.`int_rt_events_resolved`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-10-28T08:35:09.167315Z", "completed_at": "2025-10-28T08:35:09.173182Z"}, {"name": "execute", "started_at": "2025-10-28T08:35:09.173767Z", "completed_at": "2025-10-28T08:35:10.290392Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 1.1241137981414795, "adapter_response": {"_message": "CREATE VIEW (0 processed)", "code": "CREATE VIEW", "bytes_processed": 0, "bytes_billed": 0, "location": "US", "project_id": "whyline-denver", "job_id": "fe18e6c4-adc2-4018-a8cb-97ac74f0dc6a", "slot_ms": 0}, "message": "CREATE VIEW (0 processed)", "failures": null, "unique_id": "model.whylinedenver_dbt.int_stop_headways_observed", "compiled": true, "compiled_code": "\n\nwith base as (\n    select\n        route_id,\n        direction_id,\n        stop_id,\n        service_date_mst,\n        event_ts_utc\n    from `whyline-denver`.`stg_denver`.`int_rt_events_resolved`\n    where event_ts_utc is not null\n),\ndeduped as (\n    select\n        route_id,\n        direction_id,\n        stop_id,\n        service_date_mst,\n        event_ts_utc\n    from (\n        select\n            *,\n            row_number() over (\n                partition by route_id, direction_id, stop_id, service_date_mst, event_ts_utc\n                order by event_ts_utc\n            ) as event_rank\n        from base\n    )\n    where event_rank = 1\n)\n\nselect\n    route_id,\n    direction_id,\n    stop_id,\n    service_date_mst,\n    event_ts_utc,\n    timestamp_diff(\n        event_ts_utc,\n        lag(event_ts_utc) over (\n            partition by route_id, direction_id, stop_id, service_date_mst\n            order by event_ts_utc\n        ),\n        second\n    ) as obs_headway_sec\nfrom deduped", "relation_name": "`whyline-denver`.`stg_denver`.`int_stop_headways_observed`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-10-28T08:35:10.296437Z", "completed_at": "2025-10-28T08:35:10.305701Z"}, {"name": "execute", "started_at": "2025-10-28T08:35:10.306086Z", "completed_at": "2025-10-28T08:35:14.191678Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 3.8962149620056152, "adapter_response": {"_message": "MERGE (52.0 rows, 77.3 MiB processed)", "code": "MERGE", "rows_affected": 52, "bytes_processed": 81080296, "bytes_billed": 81788928, "location": "US", "project_id": "whyline-denver", "job_id": "a98035fa-0e49-46a5-9fe1-74d4b4e330d4", "slot_ms": 99754}, "message": "MERGE (52.0 rows, 77.3 MiB processed)", "failures": null, "unique_id": "model.whylinedenver_dbt.mart_reliability_by_route_day", "compiled": true, "compiled_code": "\n\nwith e as (\n    select\n        route_id,\n        service_date_mst,\n        delay_sec,\n        delay_sec_raw\n    from `whyline-denver`.`stg_denver`.`int_rt_events_resolved`\n    where true\n    \n        and service_date_mst >= (\n            select ifnull(\n                max(service_date_mst),\n                date_sub(current_date(\"America/Denver\"), interval 35 day)\n            )\n            from `whyline-denver`.`mart_denver`.`mart_reliability_by_route_day`\n        )\n    \n),\nw as (\n    select\n        service_date_mst,\n        precip_bin,\n        snow_day\n    from `whyline-denver`.`stg_denver`.`int_weather_by_date`\n)\n\nselect\n    e.route_id,\n    e.service_date_mst,\n    coalesce(w.precip_bin, 'none') as precip_bin,\n    coalesce(w.snow_day, false) as snow_day,\n    count(*) as n_events,\n    countif(delay_sec_raw is not null) as n_reported_events,\n    avg(case when abs(delay_sec) <= 300 then 1 else 0 end) as pct_on_time,\n    avg(delay_sec) as mean_delay_sec,\n    approx_quantiles(delay_sec, 100)[offset(50)] as median_delay_sec,\n    approx_quantiles(delay_sec, 100)[offset(90)] as p90_delay_sec,\n    current_timestamp() as build_run_at\nfrom e\nleft join w\n    using (service_date_mst)\ngroup by\n    route_id,\n    service_date_mst,\n    precip_bin,\n    snow_day", "relation_name": "`whyline-denver`.`mart_denver`.`mart_reliability_by_route_day`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-10-28T08:35:14.198954Z", "completed_at": "2025-10-28T08:35:14.206161Z"}, {"name": "execute", "started_at": "2025-10-28T08:35:14.206839Z", "completed_at": "2025-10-28T08:35:15.296191Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 1.0987629890441895, "adapter_response": {"_message": "CREATE VIEW (0 processed)", "code": "CREATE VIEW", "bytes_processed": 0, "bytes_billed": 0, "location": "US", "project_id": "whyline-denver", "job_id": "a3ee5904-6d96-4d8b-bd3d-8fb596b3a00f", "slot_ms": 0}, "message": "CREATE VIEW (0 processed)", "failures": null, "unique_id": "model.whylinedenver_dbt.int_headway_adherence", "compiled": true, "compiled_code": "\n\nwith obs as (\n    select\n        route_id,\n        direction_id,\n        stop_id,\n        service_date_mst,\n        event_ts_utc,\n        obs_headway_sec\n    from `whyline-denver`.`stg_denver`.`int_stop_headways_observed`\n    where obs_headway_sec is not null\n),\nsch as (\n    select\n        route_id,\n        direction_id,\n        stop_id,\n        service_date_mst,\n        sched_arrival_ts_mst,\n        sch_headway_sec\n    from `whyline-denver`.`stg_denver`.`int_stop_headways_scheduled`\n    where sch_headway_sec is not null\n),\nnearest as (\n    select\n        o.route_id,\n        o.direction_id,\n        o.stop_id,\n        o.service_date_mst,\n        o.event_ts_utc,\n        o.obs_headway_sec,\n        s.sch_headway_sec,\n        abs(timestamp_diff(o.event_ts_utc, s.sched_arrival_ts_mst, second)) as dt_abs\n    from obs as o\n    join sch as s\n        on o.route_id = s.route_id\n        and coalesce(o.direction_id, -1) = coalesce(s.direction_id, -1)\n        and o.stop_id = s.stop_id\n        and o.service_date_mst = s.service_date_mst\n    qualify row_number() over (\n        partition by o.route_id, o.direction_id, o.stop_id, o.service_date_mst, o.event_ts_utc\n        order by dt_abs\n    ) = 1\n)\n\nselect\n    route_id,\n    direction_id,\n    stop_id,\n    service_date_mst,\n    event_ts_utc,\n    obs_headway_sec,\n    sch_headway_sec,\n    dt_abs,\n    case\n        when dt_abs <= 1800\n         and sch_headway_sec > 0\n         and abs(obs_headway_sec - sch_headway_sec) / sch_headway_sec <= 0.5\n        then 1\n        else 0\n    end as headway_adherent\nfrom nearest", "relation_name": "`whyline-denver`.`stg_denver`.`int_headway_adherence`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-10-28T08:35:15.304039Z", "completed_at": "2025-10-28T08:35:15.310449Z"}, {"name": "execute", "started_at": "2025-10-28T08:35:15.310923Z", "completed_at": "2025-10-28T08:35:17.892879Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 2.5901639461517334, "adapter_response": {"_message": "CREATE TABLE (123.0 rows, 83.4 KiB processed)", "code": "CREATE TABLE", "rows_affected": 123, "bytes_processed": 85389, "bytes_billed": 10485760, "location": "US", "project_id": "whyline-denver", "job_id": "6eb6d43b-4b5d-4bb8-8894-98bbfa7dd20b", "slot_ms": 7227}, "message": "CREATE TABLE (123.0 rows, 83.4 KiB processed)", "failures": null, "unique_id": "model.whylinedenver_dbt.mart_weather_impacts", "compiled": true, "compiled_code": "\n\nwith base as (\n    select\n        route_id,\n        precip_bin,\n        pct_on_time\n    from `whyline-denver`.`mart_denver`.`mart_reliability_by_route_day`\n),\navgd as (\n    select\n        route_id,\n        precip_bin,\n        avg(pct_on_time) as pct_on_time_avg\n    from base\n    group by\n        route_id,\n        precip_bin\n),\nnorm as (\n    select\n        a.route_id,\n        a.precip_bin,\n        a.pct_on_time_avg,\n        n.pct_on_time_avg as pct_on_time_normal\n    from avgd as a\n    left join avgd as n\n        on a.route_id = n.route_id\n        and n.precip_bin = 'none'\n)\n\nselect\n    route_id,\n    precip_bin,\n    pct_on_time_avg,\n    pct_on_time_normal,\n    pct_on_time_avg - pct_on_time_normal as delta_pct_on_time,\n    current_timestamp() as build_run_at\nfrom norm", "relation_name": "`whyline-denver`.`mart_denver`.`mart_weather_impacts`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-10-28T08:35:17.898482Z", "completed_at": "2025-10-28T08:35:17.905591Z"}, {"name": "execute", "started_at": "2025-10-28T08:35:17.905981Z", "completed_at": "2025-10-28T08:35:56.405097Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 38.508328914642334, "adapter_response": {"_message": "MERGE (150.0 rows, 231.3 MiB processed)", "code": "MERGE", "rows_affected": 150, "bytes_processed": 242569600, "bytes_billed": 243269632, "location": "US", "project_id": "whyline-denver", "job_id": "3400f569-34e3-49ac-89a4-15f52ad9d55f", "slot_ms": 915436}, "message": "MERGE (150.0 rows, 231.3 MiB processed)", "failures": null, "unique_id": "model.whylinedenver_dbt.mart_reliability_by_stop_hour", "compiled": true, "compiled_code": "\n\nwith base as (\n    select\n        stop_id,\n        route_id,\n        service_date_mst,\n        event_hour_mst,\n        delay_sec\n    from `whyline-denver`.`stg_denver`.`int_rt_events_resolved`\n    where stop_id is not null\n    \n        and service_date_mst >= (\n            select ifnull(\n                max(service_date_mst),\n                date_sub(current_date(\"America/Denver\"), interval 35 day)\n            )\n            from `whyline-denver`.`mart_denver`.`mart_reliability_by_stop_hour`\n        )\n    \n),\nhead AS (\n    select\n        stop_id,\n        service_date_mst,\n        extract(hour from event_ts_utc at time zone \"America/Denver\") as event_hour_mst,\n        avg(headway_adherent) as headway_adherence_rate,\n        approx_quantiles(obs_headway_sec, 100)[offset(50)] as obs_headway_sec_p50,\n        approx_quantiles(obs_headway_sec, 100)[offset(90)] as obs_headway_sec_p90\n    from `whyline-denver`.`stg_denver`.`int_headway_adherence`\n    group by\n        stop_id,\n        service_date_mst,\n        event_hour_mst\n),\nagg as (\n    select\n        stop_id,\n        service_date_mst,\n        event_hour_mst,\n        count(*) as n_events,\n        avg(case when abs(delay_sec) <= 300 then 1 else 0 end) as pct_on_time,\n        avg(delay_sec) as mean_delay_sec,\n        approx_quantiles(delay_sec, 100)[offset(90)] as p90_delay_sec\n    from base\n    group by\n        stop_id,\n        service_date_mst,\n        event_hour_mst\n),\nroute_mode as (\n    select\n        stop_id,\n        service_date_mst,\n        event_hour_mst,\n        array_agg(route_id order by route_events desc, route_id limit 1)[offset(0)] as route_id_mode\n    from (\n        select\n            stop_id,\n            service_date_mst,\n            event_hour_mst,\n            route_id,\n            count(*) as route_events\n        from base\n        where route_id is not null\n        group by\n            stop_id,\n            service_date_mst,\n            event_hour_mst,\n            route_id\n    )\n    group by\n        stop_id,\n        service_date_mst,\n        event_hour_mst\n)\n\nselect\n    a.stop_id,\n    a.service_date_mst,\n    a.event_hour_mst,\n    a.n_events,\n    a.pct_on_time,\n    a.mean_delay_sec,\n    a.p90_delay_sec,\n    coalesce(rm.route_id_mode, 'unknown') as route_id_mode,\n    h.headway_adherence_rate,\n    h.obs_headway_sec_p50,\n    h.obs_headway_sec_p90,\n    current_timestamp() as build_run_at\nfrom agg as a\nleft join head as h\n    using (stop_id, service_date_mst, event_hour_mst)\nleft join route_mode as rm\n    using (stop_id, service_date_mst, event_hour_mst)", "relation_name": "`whyline-denver`.`mart_denver`.`mart_reliability_by_stop_hour`"}], "elapsed_time": 55.90371918678284, "args": {"printer_width": 80, "require_resource_names_without_spaces": false, "vars": {}, "defer": false, "target": "prod", "log_file_max_bytes": 10485760, "enable_legacy_logger": false, "log_format": "default", "send_anonymous_usage_stats": true, "require_explicit_package_overrides_for_builtin_materializations": true, "introspect": true, "favor_state": false, "log_level_file": "debug", "macro_debugging": false, "select": ["+mart_reliability_by_stop_hour", "+mart_reliability_by_route_day", "+mart_weather_impacts"], "project_dir": "dbt", "exclude": [], "partial_parse_file_diff": true, "cache_selected_only": false, "write_json": true, "profiles_dir": "/Users/medsidd/Desktop/whyline-denver/dbt/profiles", "indirect_selection": "eager", "quiet": false, "source_freshness_run_project_hooks": false, "use_colors": true, "static_parser": true, "print": true, "log_format_file": "debug", "warn_error_options": {"include": [], "exclude": []}, "partial_parse": true, "log_level": "info", "empty": false, "show_resource_report": false, "log_path": "dbt/logs", "invocation_command": "dbt run --project-dir dbt --target prod --select +mart_reliability_by_stop_hour +mart_reliability_by_route_day +mart_weather_impacts", "populate_cache": true, "strict_mode": false, "use_colors_file": true, "version_check": true, "which": "run"}}